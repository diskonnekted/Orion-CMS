(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blockEditor,n=window.wp.compose,o=window.wp.hooks,i=window.wp.plugins,r=window.wp.apiFetch;var l=e.n(r);const s=window.wp.components,a=window.wp.data,c=window.wp.editor,u=window.wp.element,d=window.wp.primitives,p=window.ReactJSXRuntime;var m=(0,p.jsx)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,p.jsx)(d.Path,{d:"m11.3 17.2-5-5c-.1-.1-.1-.3 0-.4l2.3-2.3-1.1-1-2.3 2.3c-.7.7-.7 1.8 0 2.5l5 5H7.5v1.5h5.3v-5.2h-1.5v2.6zm7.5-6.4-5-5h2.7V4.2h-5.2v5.2h1.5V6.8l5 5c.1.1.1.3 0 .4l-2.3 2.3 1.1 1.1 2.3-2.3c.6-.7.6-1.9-.1-2.5z"})});const w=window.wp.i18n,h=window.wp.notices,{aiTitleGenerationData:f}=window;function v({title:e,index:t,onChange:n,onSelect:o}){return(0,p.jsxs)(s.FlexItem,{className:"ai-title",children:[(0,p.jsx)(s.TextareaControl,{rows:2,label:(0,w.__)("Generated title","ai"),hideLabelFromVision:!0,value:e,onChange:n,__nextHasNoMarginBottom:!0}),(0,p.jsx)(s.Button,{variant:"secondary",style:{marginTop:"15px"},onClick:()=>o(e,t),children:(0,w.__)("Select","ai")})]})}function x({titles:e,onTitleChange:t,onSelect:n}){return e&&0!==e.length?(0,p.jsx)(s.Flex,{gap:"5",wrap:!0,direction:"column",children:e.map((o,i)=>(0,p.jsx)(v,{title:o,index:i,onChange:n=>{t(e.map((e,t)=>t===i?n:e))},onSelect:n},`title-${i}`))}):null}function g(){const e=(0,a.select)(c.store).getCurrentPostId(),t=(0,a.select)(c.store).getEditedPostContent(),n=(0,a.select)(c.store).getEditedPostAttribute("title"),{editPost:o}=(0,a.useDispatch)(c.store),[i,r]=(0,u.useState)(!1),[d,v]=(0,u.useState)(!1),[g,b]=(0,u.useState)([]),y=()=>{v(!1),b([])},_=n.trim().length>0?(0,w.__)("Re-generate","ai"):(0,w.__)("Generate","ai");return f?.enabled?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(c.PostTypeSupportCheck,{supportKeys:"title",children:(0,p.jsx)(s.ToolbarGroup,{children:(0,p.jsx)(s.ToolbarButton,{icon:m,label:_,onClick:async()=>{r(!0),(0,a.dispatch)(h.store).removeNotice("ai_title_generation_error");try{const n=await async function(e,t){var n;return l()({path:null!==(n=f?.path)&&void 0!==n?n:"",method:"POST",data:{input:{post_id:e,content:t}}}).then(e=>e&&"object"==typeof e&&"titles"in e?e.titles:[]).catch(e=>{throw new Error(`Error generating titles: ${e.message}`)})}(e,t);b(n),v(!0)}catch(e){(0,a.dispatch)(h.store).createErrorNotice(e,{id:"ai_title_generation_error",isDismissible:!0}),b([])}finally{r(!1)}},disabled:i,isBusy:i,children:_})})}),d&&(0,p.jsx)(s.Modal,{title:(0,w.__)("Select a title","ai"),onRequestClose:y,isFullScreen:!1,size:"medium",className:"ai-title-generation-modal",children:g&&(0,p.jsx)(x,{titles:g,onTitleChange:b,onSelect:async e=>{o({title:e}),y()}})})]}):null}function b(e,t,n,o=200){let i=0,r=null;const l=()=>{i<n&&(i++,r=setTimeout(()=>{r=null,e()?t():l()},o))};return()=>{r||l()}}function y(e,t,n=10){return{focus:e,blur:()=>{setTimeout(t,n)}}}function _(e,t,n=!1){const o=n?"focusin":"focus",i=n?"focusout":"blur";return e.addEventListener(o,t.focus),e.addEventListener(i,t.blur),()=>{e.removeEventListener(o,t.focus),e.removeEventListener(i,t.blur)}}const j=(0,n.createHigherOrderComponent)(e=>n=>"core/post-title"!==n.name?(0,p.jsx)(e,{...n}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(e,{...n}),(0,p.jsx)(t.BlockControls,{children:(0,p.jsx)(g,{})})]}),"withTitleToolbar");(0,o.addFilter)("editor.BlockEdit","ai/title-generation",j),(0,i.registerPlugin)("ai-title-generation-normal-mode",{render:function(){return(0,u.useEffect)(()=>{let e=!1,t=null,n=null,o=null,i=null,r=null,l=null,s=null;const a=()=>{const e=document.querySelector('iframe[name="editor-canvas"], iframe.wp-block-editor-iframe__iframe');return e&&e.contentDocument?e.contentDocument:null},c=()=>{l&&(l.style.display="flex")},d=()=>{(()=>{const e=a();if(!e)return!1;const t=e.activeElement;return!(!t||t!==r&&!r?.contains(t)&&(!l||t!==l&&!l.contains(t)&&!l.querySelector(".components-dropdown-menu .is-opened")))})()?c():l&&(l.style.display="none")},m=()=>{if(e)return;const i=a();if(!i)return void b(()=>null!==a(),m,20)();if(i.querySelector(".ai-title-toolbar-wrapper"))return void(e=!0);const w=[".editor-post-title__input"];let h=null;for(const e of w)if(h=i.querySelector(e),h)break;if(!h)return void b(()=>{const e=a();return!!e&&!!e.querySelector(".editor-post-title__input")},m,10)();if(r=h,r.closest(".ai-title-toolbar-wrapper"))return void(e=!0);const f=r.parentElement;if(!f)return;const v=r.nextSibling;s=i.createElement("div"),s.className="ai-title-toolbar-wrapper",s.style.cssText="position: relative;",l=i.createElement("div"),l.className="ai-title-toolbar-container",l.style.cssText="display: none; position: absolute; z-index: 1000; top: -60px;",s.appendChild(l),s.appendChild(r),f.insertBefore(s,v),t=(0,u.createRoot)(l),t.render((0,p.jsx)(g,{}));const x=y(c,d);n=_(r,x);const j=y(c,d);o=_(l,j,!0),i.activeElement===r&&c(),e=!0},w=setTimeout(()=>{m()},100),h=setTimeout(()=>{const t=a();t&&!i&&(i=new MutationObserver((n,o)=>{e||t.querySelector(".ai-title-toolbar-wrapper")?e&&o.disconnect():m()}),i.observe(t.body,{childList:!0,subtree:!0}))},500);return()=>{i&&i.disconnect(),clearTimeout(w),clearTimeout(h),n&&n(),o&&o(),t&&t.unmount(),s?s.remove():l&&l.remove()}},[]),(0,p.jsx)(p.Fragment,{})}})})();