(()=>{"use strict";const{aiAbilityExplorer:t,navigator:e}=window;!function(){const i={init(){this.initTestRunner(),this.initCopyButtons(),this.initValidation()},initTestRunner(){const t=this,e=document.getElementById("ability-test-invoke");e&&e.addEventListener("click",function(){const e=this.dataset.ability,i=document.getElementById("ability-test-payload"),n=i?i.value:"";t.invokeAbility(e,n)});const i=document.getElementById("ability-test-validate");i&&i.addEventListener("click",function(){t.validateInput()});const n=document.getElementById("ability-test-clear");n&&n.addEventListener("click",function(){const t=document.getElementById("ability-test-result-container"),e=document.getElementById("ability-test-result"),i=document.getElementById("ability-test-validation");t&&(t.style.display="none"),e&&(e.innerHTML=""),i&&(i.style.display="none")});const s=document.getElementById("ability-test-payload");s&&s.addEventListener("blur",function(){t.formatJSON(this)})},initCopyButtons(){const t=this;document.querySelectorAll(".ability-copy-btn").forEach(function(e){e.addEventListener("click",function(){const e=this.dataset.copy,i=document.getElementById(e);i&&t.copyToClipboard(i.textContent,this)})})},initValidation(){const t=document.getElementById("ability-test-payload");t&&t.addEventListener("input",function(){const t=this.value.trim();if(this.classList.remove("json-valid","json-invalid"),t)try{JSON.parse(t),this.classList.add("json-valid")}catch(t){this.classList.add("json-invalid")}})},invokeAbility(e,i){const n=this;try{JSON.parse(i)}catch(e){return void n.showValidation(!1,[t.strings.invalidJson])}const s=document.getElementById("ability-test-invoke");if(s){s.disabled=!0;const e=s.dataset.originalText||s.textContent;s.dataset.originalText||(s.dataset.originalText=e),s.innerHTML=t.strings.invoking+'<span class="ability-loading"></span>'}const o=new FormData;o.append("action","ai_ability_explorer_invoke"),o.append("nonce",t.nonce),o.append("ability",e),o.append("input",i),fetch(t.ajaxUrl,{method:"POST",body:o,credentials:"same-origin"}).then(function(t){return t.json()}).then(function(t){t.success?n.showResult(!0,t.data):n.showResult(!1,t.data)}).catch(function(t){n.showResult(!1,{message:t.message,error:"AJAX request failed"})}).finally(function(){s&&(s.disabled=!1,s.textContent=s.dataset.originalText)});const a=document.getElementById("ability-test-validation");a&&(a.style.display="none")},validateInput(){const e=document.getElementById("ability-test-payload"),i=e?e.value.trim():"";let n;try{n=JSON.parse(i)}catch(e){return void this.showValidation(!1,[t.strings.invalidJson+": "+e.message])}const s=document.getElementById("ability-input-schema");if(!s)return void this.showValidation(!0,["JSON syntax is valid"]);let o;try{o=JSON.parse(s.textContent)}catch(t){return void this.showValidation(!1,["Failed to parse input schema"])}const a=this.validateAgainstSchema(n,o);0===a.length?this.showValidation(!0,["Input is valid according to the schema"]):this.showValidation(!1,a)},validateAgainstSchema(t,e){const i=[];return e.required&&Array.isArray(e.required)&&e.required.forEach(function(e){e in t||i.push('Required field "'+e+'" is missing')}),e.properties&&Object.keys(e.properties).forEach(function(n){if(n in t){const s=e.properties[n],o=t[n];s.type&&(this.validateType(o,s.type)||i.push('Field "'+n+'" should be of type "'+s.type+'"'))}}.bind(this)),i},validateType(t,e){switch(e){case"string":return"string"==typeof t;case"number":case"integer":return"number"==typeof t;case"boolean":return"boolean"==typeof t;case"array":return Array.isArray(t);case"object":return"object"==typeof t&&!Array.isArray(t);default:return!0}},showValidation(t,e){const i=document.getElementById("ability-test-validation");if(!i)return;const n=t?"validation-success":"validation-error";let s="<h4>"+(t?"✓":"✗")+" "+(t?"Valid":"Validation Errors")+"</h4>";e.length>0&&(s+="<ul>",e.forEach(function(t){s+="<li>"+this.escapeHtml(t)+"</li>"}.bind(this)),s+="</ul>"),i.innerHTML=s,i.classList.remove("validation-success","validation-error"),i.classList.add(n),i.style.display="block"},showResult(e,i){const n=document.getElementById("ability-test-result-container"),s=document.getElementById("ability-test-result");if(!n||!s)return;const o=e?"ability-test-result-success":"ability-test-result-error";let a="<h4>"+(e?t.strings.success:t.strings.error)+"</h4>";a+="<pre>"+this.escapeHtml(JSON.stringify(i,null,2))+"</pre>",s.innerHTML=a,s.classList.remove("ability-test-result-success","ability-test-result-error"),s.classList.add(o),n.style.display="block";const l=n.getBoundingClientRect(),c=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,r=l.top+c-50;window.scrollTo({top:r,behavior:"smooth"})},formatJSON(t){const e=t.value.trim();if(e)try{const i=JSON.parse(e),n=JSON.stringify(i,null,2);t.value=n}catch(t){}},copyToClipboard(t,i){if(e.clipboard&&window.isSecureContext)e.clipboard.writeText(t).then(function(){this.showCopyFeedback(i,!0)}.bind(this),function(){this.showCopyFeedback(i,!1)}.bind(this));else{const e=document.createElement("textarea");document.body.appendChild(e),e.value=t,e.select();try{const t=document.execCommand("copy");this.showCopyFeedback(i,t)}catch(t){this.showCopyFeedback(i,!1)}document.body.removeChild(e)}},showCopyFeedback(e,i){const n=e.textContent,s=i?t.strings.copySuccess:t.strings.copyError;e.textContent=s,setTimeout(function(){e.textContent=n},2e3)},escapeHtml(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,function(t){return e[t]})}};if(!t?.enabled)return null;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){i.init()}):i.init()}()})();