(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=window.wp.i18n,n=window.wp.apiFetch;var i=t.n(n);const a=window.wp.url;let s=!1;const r=()=>{s||(console.warn("[AI Experiments] wp.abilities.executeAbility is unavailable. Falling back to REST."),s=!0)};class o{textarea=null;button=null;spinner=null;status=null;isGenerating=!1;constructor(){var t,e;this.context={getAttachmentId:()=>null,getImageUrl:()=>null};const n=null!==(t=null!==(e=document.querySelector("#attachment-details-two-column-alt-text"))&&void 0!==e?e:document.querySelector("#attachment-details-alt-text"))&&void 0!==t?t:document.querySelector("#attachment_alt"),i=document.querySelector(".ai-alt-text-media-actions"),a=document.querySelector("#ai-alt-text-generate-button");n&&i&&a&&(this.textarea=n,this.button=a,this.spinner=i.querySelector(".spinner"),this.status=i.querySelector(".description"),a.addEventListener("click",t=>{const e=t.target.getAttribute("data-attachment-id");e&&(this.context={getAttachmentId:()=>parseInt(e,10),getImageUrl:()=>null}),this.handleGenerate()}),n.addEventListener("input",()=>{this.updateButtonLabel()}))}updateButtonLabel(){if(!this.textarea||!this.button)return;const t=this.textarea.value.trim().length>0;this.button.textContent=t?(0,e.__)("Regenerate","ai"):(0,e.__)("Generate","ai")}async handleGenerate(){if(!this.isGenerating&&this.textarea&&this.button&&this.spinner){this.isGenerating=!0,this.button.disabled=!0,this.spinner.classList.add("is-active"),this.setStatus((0,e.__)("Generating alt textâ€¦","ai"));try{const t=await async function(t){const n={},s=t.getAttachmentId();if(s)n.attachment_id=s;else{const e=t.getImageUrl();e&&(n.image_url=e)}if(0===Object.keys(n).length)throw new Error((0,e.__)("Unable to determine which image to describe.","ai"));const o=await async function(t,e,n){var s;const o=null!==(l=window?.wp?.abilities)&&void 0!==l?l:null;var l;if("function"==typeof o?.executeAbility)try{return await o.executeAbility(t,null!=e?e:null)}catch(t){if(!(t=>{if(!t||"object"!=typeof t)return!1;const e="message"in t&&"string"==typeof t.message?t.message:"";return"ability_not_found"===("code"in t&&"string"==typeof t.code?t.code:"")||e.includes("Ability not found")})(t))throw t;r()}else r();const u=null!==(s=n?.method)&&void 0!==s?s:"POST",c=await i()(((t,e,n)=>{const i=null!=e?e:null;return"GET"===n||"DELETE"===n?{path:null===i?`/wp-abilities/v1/abilities/${t}/run`:(0,a.addQueryArgs)(`/wp-abilities/v1/abilities/${t}/run`,{input:i}),method:n}:{path:`/wp-abilities/v1/abilities/${t}/run`,method:"POST",data:{input:i}}})(t,e,u));return c}("ai/alt-text-generation",n);if(o?.alt_text)return o.alt_text;throw new Error((0,e.__)("Failed to generate alt text.","ai"))}(this.context);this.textarea.value=t,this.textarea.dispatchEvent(new Event("input",{bubbles:!0})),this.textarea.dispatchEvent(new Event("change",{bubbles:!0})),this.setStatus((0,e.__)("Alt text generated and applied.","ai"))}catch(t){const n=function(t){return t&&"object"==typeof t&&"message"in t&&"string"==typeof t.message?t.message:(0,e.__)("An unexpected error occurred while generating alt text.","ai")}(t);this.setStatus(n,!0)}finally{this.isGenerating=!1,this.button.disabled=!1,this.spinner.classList.remove("is-active"),this.updateButtonLabel()}}}setStatus(t,e=!1){this.status&&(this.status.textContent=t,this.status.style.color=e?"#b32d2e":"#646970")}}function l(){new o}window.jQuery?.(document).ready(function(){const t=window.aiAltTextGenerationMediaData;if(!t?.enabled)return;document.querySelector("#ai_alt_text_generation")&&l();const{wp:e}=window;e?.media&&(e.media?.view?.Modal?.prototype?.on("open",function(){e?.media?.frame?.on("selection:toggle",l)}),e.media?.frame?.on("edit:attachment",l),e.Uploader?.queue?.on("reset",l))})})();