(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=window.wp.hooks,n=window.wp.compose,i=window.wp.components,r=window.wp.blockEditor,a=window.wp.element,o=window.wp.i18n,l=window.wp.data,s=window.wp.notices,c=window.wp.editor,d=window.wp.blocks,u=window.wp.apiFetch;var w=t.n(u);const p=window.wp.url;let x=!1;const h=()=>{x||(console.warn("[AI Experiments] wp.abilities.executeAbility is unavailable. Falling back to REST."),x=!0)};const m="[[IMAGE_GOES_HERE]]";async function g(t,e,n,i){const a={};if(t)a.attachment_id=t;else{if(!e)throw new Error((0,o.__)("No image available to generate alt text for.","ai"));a.image_url=e}if(n){const t=void 0!==i?function(t,e){const n=(0,l.select)(r.store).getBlock(e);if(!n)return t;const i=(0,d.serialize)(n);return i&&t.includes(i)?t.replace(i,m):t}(n,i):n;a.context=`What follows is the full article content, where the image has been replaced with the placeholder ${m}. Use the surrounding text to understand the purpose, subject, and relevance of the image within the article. Be sure to describe only information not already conveyed in nearby text. CONTENT: \n\n${t}`}const s=await async function(t,e,n){var i;const r=null!==(a=window?.wp?.abilities)&&void 0!==a?a:null;var a;if("function"==typeof r?.executeAbility)try{return await r.executeAbility(t,null!=e?e:null)}catch(t){if(!(t=>{if(!t||"object"!=typeof t)return!1;const e="message"in t&&"string"==typeof t.message?t.message:"";return"ability_not_found"===("code"in t&&"string"==typeof t.code?t.code:"")||e.includes("Ability not found")})(t))throw t;h()}else h();const o=null!==(i=n?.method)&&void 0!==i?i:"POST",l=await w()(((t,e,n)=>{const i=null!=e?e:null;return"GET"===n||"DELETE"===n?{path:null===i?`/wp-abilities/v1/abilities/${t}/run`:(0,p.addQueryArgs)(`/wp-abilities/v1/abilities/${t}/run`,{input:i}),method:n}:{path:`/wp-abilities/v1/abilities/${t}/run`,method:"POST",data:{input:i}}})(t,e,o));return l}("ai/alt-text-generation",a);if(s&&"object"==typeof s&&"alt_text"in s)return s.alt_text;throw new Error((0,o.__)("Failed to generate alt text.","ai"))}const _=window.ReactJSXRuntime;function b(t){return t?(0,o.__)("Regenerate Alt Text","ai"):(0,o.__)("Generate Alt Text","ai")}function y({clientId:t,attributes:e,setAttributes:n}){const{id:d,url:u,alt:w}=e,[p,x]=(0,a.useState)(!1),[h,m]=(0,a.useState)(null),[y,f]=(0,a.useState)(null);if(!d&&!u)return null;const v=w&&w.trim().length>0,j=null!==h;return(0,_.jsx)(r.InspectorControls,{children:(0,_.jsxs)("div",{className:"ai-alt-text-controls",style:{padding:"16px"},children:[(0,_.jsx)("h3",{style:{marginTop:0,marginBottom:"8px"},children:(0,o.__)("AI Alternative Text","ai")}),y&&(0,_.jsx)(i.Notice,{status:"error",isDismissible:!0,onRemove:()=>f(null),children:(0,_.jsx)("div",{style:{marginBottom:"12px"},children:y})}),j&&(0,_.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,_.jsx)(i.TextareaControl,{label:(0,o.__)("Generated Alt Text","ai"),hideLabelFromVision:!0,value:h||"",onChange:t=>m(t),rows:3,__nextHasNoMarginBottom:!0}),(0,_.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"8px"},children:[(0,_.jsx)(i.Button,{variant:"primary",onClick:()=>{h&&(n({alt:h}),m(null))},children:(0,o.__)("Apply","ai")}),(0,_.jsx)(i.Button,{variant:"secondary",onClick:()=>{m(null),f(null)},children:(0,o.__)("Dismiss","ai")})]})]}),!j&&(0,_.jsx)(i.Button,{variant:"secondary",onClick:async()=>{x(!0),f(null),m(null),(0,l.dispatch)(s.store).removeNotice("ai_alt_text_generation_error");try{const e=(0,l.select)(c.store).getEditedPostContent(),n=await g(d,u,e,t);m(n)}catch(t){const e=t?.message||(0,o.__)("An error occurred while generating alt text.","ai");f(e),(0,l.dispatch)(s.store).createErrorNotice(e,{id:"ai_alt_text_generation_error",isDismissible:!0})}finally{x(!1)}},disabled:p,style:{width:"100%",justifyContent:"center"},children:p?(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(i.Spinner,{}),(0,_.jsx)("span",{style:{marginLeft:"8px"},children:(0,o.__)("Generatingâ€¦","ai")})]}):b(!!v)})]})})}const{aiAltTextGenerationData:f}=window,v=(0,n.createHigherOrderComponent)(t=>e=>"core/image"!==e.name?(0,_.jsx)(t,{...e}):f?.enabled?(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(t,{...e}),(0,_.jsx)(y,{clientId:e.clientId,attributes:e.attributes,setAttributes:e.setAttributes})]}):(0,_.jsx)(t,{...e}),"withAltTextGeneration");(0,e.addFilter)("editor.BlockEdit","ai/alt-text-generation",v)})();