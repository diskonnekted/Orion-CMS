(()=>{"use strict";var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var r in a)t.o(a,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:a[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=window.wp.blocks,a=window.wp.hooks,r=window.wp.i18n,i=window.wp.plugins,n=window.wp.components,o=window.wp.editor,s=window.wp.primitives,m=window.ReactJSXRuntime;var c=(0,m.jsx)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,m.jsx)(s.Path,{d:"m11.3 17.2-5-5c-.1-.1-.1-.3 0-.4l2.3-2.3-1.1-1-2.3 2.3c-.7.7-.7 1.8 0 2.5l5 5H7.5v1.5h5.3v-5.2h-1.5v2.6zm7.5-6.4-5-5h2.7V4.2h-5.2v5.2h1.5V6.8l5 5c.1.1.1.3 0 .4l-2.3 2.3 1.1 1.1 2.3-2.3c.6-.7.6-1.9-.1-2.5z"})});const l=window.wp.blockEditor,u=window.wp.data,d=window.wp.element,p=window.wp.notices,w=window.wp.apiFetch;var h=t.n(w);const{aiSummarizationData:y}=window;function g(){const{allBlocks:t,postId:a,content:r,meta:i}=(0,u.useSelect)(t=>({allBlocks:t(l.store).getBlocks(),postId:t(o.store).getCurrentPostId(),content:t(o.store).getEditedPostContent(),meta:t(o.store).getEditedPostAttribute("meta")})),{editPost:n}=(0,u.useDispatch)(o.store),[s,m]=(0,d.useState)(!1),[c,w]=(0,d.useState)("");return(0,d.useEffect)(()=>{const e=t.find(t=>"core/paragraph"===t.name&&!0===t.attributes.aiGeneratedSummary);e&&e.attributes.content&&w(e.attributes.content)},[t]),{isSummarizing:s,hasSummary:c&&c.trim().length>0,summary:c,handleSummarize:async()=>{m(!0),(0,u.dispatch)(p.store).removeNotice("ai_summarization_error");try{const o=await async function(t,e){var a;return h()({path:null!==(a=y?.path)&&void 0!==a?a:"",method:"POST",data:{input:{context:t.toString(),content:e}}}).then(t=>{if(t&&"string"==typeof t)return t;throw new Error("Invalid response from API")}).catch(t=>{throw new Error(t.message)})}(a,r);w(o),n({meta:{...i,ai_generated_summary:o}});const s=t.find(t=>"core/paragraph"===t.name&&!0===t.attributes.aiGeneratedSummary);if(s)(0,u.dispatch)(l.store).updateBlockAttributes(s.clientId,{content:o});else{const t=(0,e.createBlock)("core/paragraph",{content:o,className:"ai-summarization-summary",aiGeneratedSummary:!0});(0,u.dispatch)(l.store).insertBlock(t,0)}}catch(t){(0,u.dispatch)(p.store).createErrorNotice(t,{id:"ai_summarization_error",isDismissible:!0}),w("")}finally{m(!1)}}}}const{aiSummarizationData:b}=window;window.React;const S=window.wp.compose,{aiSummarizationData:_}=window,f=()=>{const{isSummarizing:t,hasSummary:e,handleSummarize:a}=g(),i=e?(0,r.__)("Re-generate AI Summary","ai"):(0,r.__)("Generate AI Summary","ai");return _?.enabled?(0,m.jsx)(l.BlockControls,{children:(0,m.jsx)(n.ToolbarGroup,{children:(0,m.jsx)(n.ToolbarButton,{label:i,icon:c,className:"ai-summarization-block-controls-button",onClick:a,disabled:t,isBusy:t})})}):null},x=(0,S.createHigherOrderComponent)(t=>e=>{const{name:a,isSelected:r,attributes:{aiGeneratedSummary:i=!1}}=e;return"core/paragraph"===a&&i?(0,m.jsxs)(m.Fragment,{children:[r&&(0,m.jsx)(f,{...e}),(0,m.jsx)(t,{...e})]}):(0,m.jsx)(t,{...e})},"addBlockControls");(0,i.registerPlugin)("classifai-plugin-summarization",{render:function(){const{isSummarizing:t,hasSummary:e,handleSummarize:a}=g(),i=e?(0,r.__)("Re-generate AI Summary","ai"):(0,r.__)("Generate AI Summary","ai"),s=e?(0,r.__)("This will update the AI generated summary block with a new summary of the content of this post.","ai"):(0,r.__)("This will create a block that is a summary of the content of this post, generated by AI.","ai");return b?.enabled?(0,m.jsx)(o.PluginPostStatusInfo,{children:(0,m.jsxs)(n.Flex,{direction:"column",className:"ai-summarization-plugin-container",gap:2,children:[(0,m.jsx)(n.FlexItem,{children:(0,m.jsx)(n.Button,{variant:"secondary",label:i,icon:c,onClick:a,disabled:t,isBusy:t,__next40pxDefaultSize:!0,children:i})}),(0,m.jsx)(n.FlexItem,{children:(0,m.jsx)("span",{className:"description",children:s})})]})}):null}}),(0,a.addFilter)("blocks.registerBlockType","ai/summarization-attribute",(t,e)=>"core/paragraph"!==e?t:{...t,attributes:{...t.attributes,aiGeneratedSummary:{type:"boolean",default:!1}}}),(0,e.registerBlockVariation)("core/paragraph",{name:"ai-summarization-summary",title:(0,r.__)("AI Summary","ai"),description:(0,r.__)("A summary of the content of the post, generated by AI.","ai"),attributes:{className:"ai-summarization-summary",aiGeneratedSummary:!0},scope:["block"],isActive:["aiGeneratedSummary"]}),(0,a.addFilter)("editor.BlockEdit","ai/summarization-block-controls",x)})();